!function(){"use strict";const e=()=>{let e=document.querySelector(".loader");e&&(e.style.display="none")},t=e=>{let t=new URLSearchParams(window.location.search),a=t.get("sid")?t.get("sid"):"",n=-1==e.indexOf("?")?"?sid="+a:"&sid="+a;return e+n},a=()=>{let e=new URLSearchParams(window.location.search);return e.get("sid")?e.get("sid"):""},n=()=>{let e=new URLSearchParams(window.location.search);return e.get("sid")?e.get("sid"):""},o=e=>{let t=e+"=",a=decodeURIComponent(document.cookie).split(";");for(let e=0;e<a.length;e++){let n=a[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""},r={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+o("kenzap_api_key"),"Kenzap-Locale":o("locale")?o("locale"):"en","Kenzap-Header":(()=>{let e=localStorage.hasOwnProperty("header")&&localStorage.hasOwnProperty("header-version")?localStorage.getItem("header-version"):0,t=window.location.hostname+"/"+n()+"/"+o("locale");return t!=o("check")&&(e=0,console.log("refresh")),((e,t,a)=>{let n="";if(a){let e=new Date;e.setTime(e.getTime()+24*a*60*60*1e3),n=";expires="+e.toUTCString()}document.cookie=e+"="+(escape(t)||"")+n+";path=/;domain=.kenzap.cloud"})("check",t,5),e})(),"Kenzap-Token":o("kenzap_token"),"Kenzap-Sid":n()},s=e=>{if(console.log(e),isNaN(e.code)){let t=e;try{t=JSON.stringify(t)}catch(e){}let a=new URLSearchParams;return a.append("cmd","report"),a.append("sid",n()),a.append("token",o("kenzap_token")),a.append("data",t),fetch("https://api-v1.kenzap.cloud/error/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:a}),void alert("Can not connect to Kenzap Cloud")}if(401===e.code){if(-1!=window.location.href.indexOf("localhost"))return void alert(e.reason);location.href="https://auth.kenzap.com/?app=65432108792785&redirect="+window.location.href}else alert(e.reason)},i=(e,t)=>{if(document.querySelector(e))for(let a of document.querySelectorAll(e))a.removeEventListener("click",t,!0),a.addEventListener("click",t,!0)};var c={state:{firstLoad:!0,ajaxQueue:0,dataAPI:null,data:null},init:function(){c.getData(),c.getAPIData()},getAPIData:function(){var t=new URLSearchParams;t.append("cmd","get_pages"),t.append("id",a()),t.append("source","production"),t.append("token",o("kenzap_token")),fetch("https://siteapi.kenzap.cloud/v1/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:t}).then((function(e){return e.json()})).then((function(t){e(),t.success?(c.state.dataAPI=t,c.startRender()):s(t)})).catch((function(e){console.error("Error:",e)}))},getData:function(){c.state.firstLoad&&(()=>{let e=document.querySelector(".loader");e&&(e.style.display="block")})(),fetch("https://api-v1.kenzap.cloud/",{method:"post",headers:r,body:JSON.stringify({query:{user:{type:"authenticate",fields:["avatar"],token:o("kenzap_token")},locale:{type:"locale",id:o("lang")}}})}).then((function(e){return e.json()})).then((function(t){c.state.data=t,e(),t.success?((e=>{if(e.header&&localStorage.setItem("header",e.header),!document.querySelector("#k-script")){let e=document.createElement("div");e.innerHTML=localStorage.getItem("header"),e=e.firstChild,document.body.prepend(e),Function(document.querySelector("#k-script").innerHTML).call("test")}e.locale&&window.i18n.init(e.locale)})(t),c.startRender()):s(t)})).catch((function(e){console.error("Error:",e)}))},startRender:function(){null!=c.state.data&&null!=c.state.dataAPI&&(c.loadPageStructure(),c.renderPage(c.state.data),c.initListeners(),c.initFooter(),c.state.firstLoad=!1)},renderPage:function(e){var a=document;(e=>{let t='<ol class="breadcrumb mt-2 mb-0">';for(let a of e)void 0===a.link?t+=`<li class="breadcrumb-item">${a.text}</li>`:t+=`<li class="breadcrumb-item"><a href="${a.link}">${a.text}</a></li>`;t+="</ol>",document.querySelector(".bc").innerHTML=t})([{link:t("/"),text:__("Dashboard")},{text:__("Pages")}]),void 0!==c.state.dataAPI.keys&&(a.querySelector("#api-public").value=c.state.dataAPI.keys.public.token,a.querySelector("#api-restricted").value=c.state.dataAPI.keys.restricted.token,a.querySelector("#api-private").value=c.state.dataAPI.keys.private.token);var n="";for(var o in c.state.dataAPI.list)n+=c.rowStruct(o);0==c.state.dataAPI.list.length?a.querySelector(".list").innerHTML='<tr><td colspan="5">'.concat(__("No users to display. Please add one by clicking on the button below."),"</td></tr>"):a.querySelector(".list").innerHTML=n},rowStruct:function(e){return'\n        <tr>\n          <td class="destt" style="max-width:250px;min-width:250px;">\n            <div>\n              <a class="text-dark" href="/edit-page/?slug='.concat(c.state.dataAPI.list[e].key+"&sid="+a(),'" ><b>').concat(c.state.dataAPI.list[e].title,'</b><i style="color:#9b9b9b;font-size:15px;margin-left:8px;" title="Edit page" class="mdi mdi-pencil menu-icon edit-page"></i></a>\n            </div>\n          </td>\n          <td>\n            <span>').concat(c.getStatus(c.state.dataAPI.list[e].status),'</span>\n          </td>\n          <td class="">\n            <span>').concat(function(e,t){console.log(e+" "+t),e=parseInt(e),t=parseInt(t),console.log(e+" "+t);var a=e-t;if(a<60)return"moments ago";if(a<3600)return parseInt(a/60)+" minutes ago";if(a<86400)return parseInt(a/60/24)+" hours ago";var n=new Date(1e3*t),o=n.getFullYear(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()],s=n.getDate();return n.getHours(),n.getMinutes(),n.getSeconds(),s+" "+r+" "+o}(c.state.data.meta.time,c.state.dataAPI.list[e].time),'</span>\n          </td>\n          <td>\n            <div class="d-flex justify-content-end">\n                <svg xmlns="http://www.w3.org/2000/svg" data-kid=\'').concat(c.state.dataAPI.list[e].key,"' data-key=\"").concat(c.state.dataAPI.list[e].key,'" width="16" height="16" fill="currentColor" class="bi bi-trash set-home me-3 ').concat(c.state.dataAPI.list[e].key==c.state.dataAPI.home?"text-primary":"text-secondary",'" viewBox="0 0 16 16">\n                    <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>\n                </svg>\n                <svg xmlns="http://www.w3.org/2000/svg" data-kid=\'').concat(c.state.dataAPI.list[e].key,"' data-key=\"").concat(c.state.dataAPI.list[e].key,'" width="16" height="16" fill="currentColor" class="bi bi-trash text-danger remove-page" viewBox="0 0 16 16">\n                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>\n                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>\n                </svg>\n            </div>\n          </td>\n        </tr>')},getType:function(e){var t="";switch(e){case"admin":t='<div title="Administrator" class="badge bg-danger fw-light">Administrator</div>';break;case"editor":t='<div title="Editor" class="badge bg-primary fw-light">Editor</div>';break;case"viewer":t='<div title="Viewer" class="badge bg-success fw-light">Viewer</div>'}return t},initHeader:function(e){i(".nav-back",(function(e){e.preventDefault(),console.log(".nav-back"),(e=>{let t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t)})(document.querySelector(".bc ol li:nth-last-child(2)").querySelector("a"))}))},initListeners:function(){console.log("initListeners "),i(".remove-page",c.listeners.removePage),i(".set-home",c.listeners.setHome),c.state.firstLoad&&(i(".btn-add",c.listeners.addPage),i(".btn-modal",c.listeners.modalSuccessBtn))},listeners:{addPage:function(){var e=document.querySelector(".modal"),t=new bootstrap.Modal(e);e.querySelector(".modal-title").innerHTML=__("Add page"),e.querySelector(".btn-primary").innerHTML=__("Add"),e.querySelector(".btn-secondary").innerHTML=__("Cancel");var n='\n            <div class="form-cont">\n                <div class="form-group mb-3">\n                    <label for="ptitle" class="form-label">'.concat(__("Title"),'</label>\n                    <input type="text" class="form-control" id="ptitle" autocomplete="off" placeholder="').concat(__("About Us"),'">\n                </div>\n                <div class="form-group mb-3">\n                    <label for="pdesc" class="form-label">').concat(__("Description"),'</label>\n                    <textarea class="form-control" id="pdesc" rows="4" placeholder="').concat(__("Our company creates services for.."),'"></textarea>\n                </div>\n                <div class="form-group mb-3 d-none">\n                    <label for="ptemplate" class="form-label">').concat(__("Template (Optional)"),'</label>\n                    <input type="text" class="form-control" id="ptemplate" autocomplete="off" placeholder="universal">\n                </div>\n            </div>\n            ');e.querySelector(".modal-body").innerHTML=n,c.listeners.modalSuccessBtnFunc=function(n){if(n.preventDefault(),"true"!==e.querySelector(".btn-primary").dataset.loading){e.querySelector(".btn-primary").dataset.loading=!0,e.querySelector(".btn-primary").innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>'+__("Loading..");var r=e.querySelector("#ptitle").value,i=e.querySelector("#pdesc").value;if(r.length<2)return alert(__("Please provide a longer title.")),!1;var l=new URLSearchParams;l.append("cmd","create_page"),l.append("id",a()),l.append("t",r),l.append("d",i),l.append("template","universal"),l.append("token",o("kenzap_token")),fetch("https://siteapi.kenzap.cloud/v1/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:l}).then((function(e){return e.json()})).then((function(a){if(e.querySelector(".btn-primary").innerHTML=__("Add"),a.success){var n=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=__("Page created"),n.show(),c.getAPIData(),e.querySelector(".btn-primary").dataset.loading=!1,t.hide()}else s(a);console.log("Success:",a)})).catch((function(e){console.error("Error:",e)}))}},t.show(),setTimeout((function(){return e.querySelector("#ptitle").focus()}),100)},removePage:function(e){e.preventDefault();var t=e.currentTarget.dataset.key;if(confirm(__("Remove this page?"))){var n=new URLSearchParams;n.append("cmd","remove_page"),n.append("id",a()),n.append("slug",t),n.append("token",o("kenzap_token")),fetch("https://siteapi.kenzap.cloud/v1/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:n}).then((function(e){return e.json()})).then((function(e){if(e.success){c.getAPIData();var t=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=__("Page removed"),t.show()}else s(e);console.log("Success:",e)})).catch((function(e){console.error("Error:",e)}))}},setHome:function(e){e.preventDefault();var t=e.currentTarget.dataset.key;if(confirm(__("Set as home page?"))){var n=new URLSearchParams;n.append("cmd","set_homepage"),n.append("id",a()),n.append("key",t),n.append("token",o("kenzap_token")),fetch("https://siteapi.kenzap.cloud/v1/",{method:"post",headers:{Accept:"application/json","Content-type":"application/x-www-form-urlencoded"},body:n}).then((function(e){return e.json()})).then((function(e){if(e.success){c.getAPIData();var t=new bootstrap.Toast(document.querySelector(".toast"));document.querySelector(".toast .toast-body").innerHTML=__("New home page is set up"),t.show()}else s(e);console.log("Success:",e)})).catch((function(e){console.error("Error:",e)}))}},modalSuccessBtn:function(e){c.listeners.modalSuccessBtnFunc(e)},modalSuccessBtnFunc:null},getStatus:function(e){switch(e=parseInt(e)){case 0:return'<div class="badge bg-warning">Draft</div>';case 1:return'<div class="badge bg-primary">Published</div>';case 3:return'<div class="badge bg-danger">Unpublished</div>';default:return'<div class="badge bg-warning text-dark">Drafts</div>'}},loadPageStructure:function(){c.state.firstLoad&&(document.querySelector("#contents").innerHTML=function(e){return'\n    <div class="container">\n      <div class="d-flex justify-content-between bd-highlight mb-3">\n          <nav class="bc" aria-label="breadcrumb"></nav>\n          <button class="btn btn-primary btn-add" type="button">'.concat(e("Add page"),'</button>\n      </div> \n      \n      <div class="row">\n\n        <div class="col-md-12 grid-margin grid-margin-lg-0 grid-margin-md-0 stretch-card">\n          <div class="card border-white shadow-sm  br">\n            <div class="card-body">\n              <div class="table-responsive">\n                <table class="table table-hover table-borderless align-middle table-striped table-p-list">\n                  <thead>\n                    <tr>\n                      <th>').concat(e("Page"),"</th>\n                      <th>").concat(e("Status"),"</th>\n                      <th>").concat(e("Last update"),'</th>\n                      <th></th>\n                    </tr>\n                  </thead>\n                  <tbody class="list"> </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>    \n    </div>\n\n    <div class="modal" tabindex="-1">\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title"></h5>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n\n                </div>\n                <div class="modal-footer">\n                    <button type="button" class="btn btn-primary btn-modal"></button>\n                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="position-fixed bottom-0 p-2 m-4 end-0 align-items-center">\n        <div class="toast hide align-items-center text-white bg-dark border-0" role="alert" aria-live="assertive"\n            aria-atomic="true" data-bs-delay="3000">\n            <div class="d-flex">\n                <div class="toast-body"></div>\n                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"\n                    aria-label="Close"></button>\n            </div>\n        </div>\n    </div>\n    ')}(__))},initFooter:function(){var e,t;e=__("Created by %1$Kenzap%2$. ❤️ Licensed %3$GPL3%4$.",'<a class="text-muted" href="https://kenzap.com/" target="_blank">',"</a>",'<a class="text-muted" href="https://github.com/kenzap/dashboard" target="_blank">',"</a>"),t=__("Copyright © %1$ %2$Dashboard%3$ Extension",(new Date).getFullYear(),'<a class="text-muted" href="https://github.com/kenzap/dashboard" target="_blank">',"</a>"),document.querySelector("footer .row").innerHTML=`\n    <div class="d-sm-flex justify-content-center justify-content-sm-between">\n        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">${e}</span>\n        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center text-muted">${t}</span>\n    </div>`}};c.init()}();
